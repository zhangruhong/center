<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wugao.center.domain.user.UserRepo">
	
	<!-- 用户 -->
	<insert id="save" parameterType="com.wugao.center.domain.user.User">
		insert into zues_rbac_user(id, username, password, nickname, mobile, email, enabled)
		values(#{id}, #{username}, #{password}, #{nickname}, #{mobile}, #{email}, #{enabled})
	</insert>
	<update id="update" parameterType="com.wugao.center.domain.user.User">
		update zues_rbac_user set
			password = #{password},
			nickname = #{nickname},
			mobile = #{mobile},
			email = #{email},
			enabled = #{enabled}
		where id = #{id}
	</update>
	<delete id="remove">
		delete from zues_rbac_user where id = #{id}
	</delete>
	<select id="getById" resultType="com.wugao.center.domain.user.User">
		select * from zues_rbac_user where id=#{id}
	</select>
	<select id="getByUsername" resultType="com.wugao.center.domain.user.User">
		select * from zues_rbac_user where username=#{username}
	</select>
	<select id="getList" resultType="com.wugao.center.domain.user.User">
		select * from zues_rbac_user where 1=1
		<if test="search != null and search != ''">
			<bind name="_search" value="'%' + search + '%'" />
			and ( username like #{_search} or nickname like #{_search} )
		</if>
		<if test="enabled != null">
			and enabled = #{enabled}
		</if>
		order by username asc
	</select>
	
	<!-- 岗位与用户 -->
	<select id="getListByPosition" resultType="com.wugao.center.domain.user.User">
		select _user.*
		from zues_rbac_position_user mapping
		left join zues_rbac_user _user on mapping.userId = _user.id
		where mapping.positionId = #{positionId}
	</select>
	
	<select id="getListByPositionOfCurrent" resultType="com.wugao.center.domain.user.User">
		select _user.*
		from zues_rbac_position_user mapping
		left join zues_rbac_user _user on mapping.userId = _user.id
		where mapping.positionId = #{positionId} and mapping.isCurrent = 1
	</select>
	
	<!-- 生产场所与用户 -->
	<select id="getListByEnterpriseSite" resultType="com.wugao.center.domain.user.User">
		select _user.* from zues_site_user_mapping mapping 
		left join zues_rbac_user _user on mapping.userId = _user.id
		where mapping.siteId = #{enterpriseSiteId}
	</select>
	
</mapper>